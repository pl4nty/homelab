# https://raw.githubusercontent.com/intuitem/ciso-assistant-community/refs/tags/v1.9.17/charts/ciso-assistant/values.schema.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: ciso-assistant
  namespace: default
spec:
  interval: 15m
  chart:
    spec:
      chart: ciso-assistant
      version: 0.1.0
      sourceRef:
        kind: HelmRepository
        name: ciso-assistant
        namespace: flux-system
  maxHistory: 3
  install:
    createNamespace: true
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    clientName: ciso-assistant
    clusterDomain: ${PUBLIC_DOMAIN}
    emailAdmin: tom@tplant.com.au
    global:
      # depName=intuitem/ciso-assistant-community
      appVersion: "v1.9.17"
  postRenderers:
    - kustomize:
        patches:
          - patch: |-
              apiVersion: apps/v1
              kind: StatefulSet
              metadata:
                name: ciso-assistant-ciso-assistant
              spec:
                template:
                  spec:
                    containers:
                      - name: ciso-assistant-backend
                        limits:
                          ephemeral-storage: 1Gi
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: ciso-assistant
  namespace: default
spec:
  parentRefs:
    - name: ${CLUSTER_NAME}
      namespace: default
  hostnames:
    - ciso-assistant.${PUBLIC_DOMAIN}
  rules:
    - backendRefs:
        - name: ciso-assistant-octopus
          port: 80
