apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- buildkit-daemon-certs.sops.yaml
- https://raw.githubusercontent.com/moby/buildkit/v0.12.3/examples/kubernetes/deployment%2Bservice.rootless.yaml
patchesStrategicMerge:
- |-
  apiVersion: v1
  kind: Service
  metadata:
    name: buildkitd
    annotations:
      service.beta.kubernetes.io/oci-load-balancer-shape: flexible
      service.beta.kubernetes.io/oci-load-balancer-shape-flex-min: "10"
      service.beta.kubernetes.io/oci-load-balancer-shape-flex-max: "10"
      external-dns.alpha.kubernetes.io/hostname: buildkit.${PUBLIC_DOMAIN}
  spec:
    type: LoadBalancer
